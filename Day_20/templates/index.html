<!DOCTYPE html>
<html>
<head>
    <title>Weather App with Maps</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
</head>
<body>
    <div class="container">
        <h1> Weather App<br><span>By Team CIST Coders</span></h1>

        <div class="forms">
            <form method="POST" class="input-box">
                <input type="text" name="lat" placeholder="Latitude" required>
                <input type="text" name="lon" placeholder="Longitude" required>
                <button type="submit">Get Weather (Lat/Lon)</button>
            </form>

            <form method="POST" class="input-box">
                <input type="text" name="city" placeholder="Enter City Name" required>
                <button type="submit">Get Weather (City)</button>
            </form>

            <button class="geo-btn" onclick="getLocation()">üìç Use My Location</button>
            <form id="geoForm" method="POST" style="display:none;">
                <input type="hidden" id="lat" name="lat">
                <input type="hidden" id="lon" name="lon">
            </form>
        </div>

        {% if weather %}
            <div class="card">
                <h2>Weather Now</h2>
                <p><b>Temperature:</b> {{ weather.temp }} ¬∞C</p>
                <p><b>Wind Speed:</b> {{ weather.windspeed }} km/h</p>
                <p><b>Time:</b> {{ weather.time }}</p>
                <p><b>Location:</b> {{ weather.location }}</p>
            </div>

            <div id="map"></div>
            <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
            <script>
                var map = L.map('map').setView([{{ weather.lat }}, {{ weather.lon }}], 10);

                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '&copy; OpenStreetMap contributors'
                }).addTo(map);

                L.marker([{{ weather.lat }}, {{ weather.lon }}]).addTo(map)
                    .bindPopup("üå°Ô∏è {{ weather.temp }} ¬∞C")
                    .openPopup();
            </script>
        {% endif %}
    </div>

    <script>
        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(pos) {
                    document.getElementById("lat").value = pos.coords.latitude;
                    document.getElementById("lon").value = pos.coords.longitude;
                    document.getElementById("geoForm").submit();
                });
            } else {
                alert("Geolocation is not supported by this browser.");
            }
        }
    </script>
</body>
</html>
